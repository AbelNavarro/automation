<?xml version="1.0" encoding="UTF-8"?>
<matrix-project>
  <actions/>
  <description/>
  <keepDependencies>false</keepDependencies>
  <properties/>
  <scm class="hudson.scm.NullSCM"/>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers class="vector">
    <hudson.triggers.TimerTrigger>
      <spec>H 12 * * *</spec>
    </hudson.triggers.TimerTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <axes>
    <hudson.matrix.TextAxis>
      <name>image</name>
      <values>
        <string>openSUSE-12.2-64-minimal</string>
        <string>openSUSE-13.1-64-minimal</string>
        <string>SLE_11_SP3-64-minimal</string>
      </values>
    </hudson.matrix.TextAxis>
    <hudson.matrix.TextAxis>
      <name>openstack_version</name>
      <values>
        <string>folsom</string>
        <string>grizzly</string>
        <string>master</string>
      </values>
    </hudson.matrix.TextAxis>
    <hudson.matrix.LabelAxis>
      <name>slave</name>
      <values>
        <string>cloud-cleanvm</string>
      </values>
    </hudson.matrix.LabelAxis>
  </axes>
  <combinationFilter>slave=="cloud-cleanvm"  &amp;&amp; (
      ( openstack_version=="master"  &amp;&amp; image=="openSUSE-13.1-64-minimal" ) ||
      ( openstack_version=="grizzly" &amp;&amp; image=="openSUSE-12.2-64-minimal" ) ||
      ( openstack_version=="folsom"  &amp;&amp; image=="openSUSE-12.2-64-minimal" )
    )
  </combinationFilter>
  <builders>
    <hudson.tasks.Shell>
      <command>[ -e ~/bin/update_automation ] || wget -O ~/bin/update_automation https://raw.github.com/SUSE-Cloud/automation/master/scripts/jenkins/update_automation &amp;&amp; chmod a+x ~/bin/update_automation
# fetch the latest automation updates
update_automation jenkins-job-trigger

freshvm cleanvm $image
sleep 100

cloudsource=openstack$openstack_version
oshead=1

ssh root@cleanvm "export cloudsource=$cloudsource; export OSHEAD=$oshead; export NONINTERACTIVE=1; curl https://raw.github.com/SUSE-Cloud/automation/master/scripts/jenkins/qa_openstack.sh|bash -x"

# mappings for submit job trigger
OSversion=`echo $openstack_version | perl -ne 'print ucfirst($_)'`
case $OSversion in
  Essex|Folsom|Grizzly)
      project=Cloud:OpenStack:$OSversion
      subproject=Staging

      # trigger submit job
      jenkins-job-trigger cloud-submit-project -p project=$project subproject=$subproject
  ;;
  Master)
      project=Cloud:OpenStack:Master
      subproject=-
  ;;
  *) echo "No valid project defined."
     exit 1
esac</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers>
    <hudson.plugins.timestamper.TimestamperBuildWrapper plugin="timestamper@1.5.4"/>
  </buildWrappers>
  <executionStrategy class="hudson.matrix.DefaultMatrixExecutionStrategyImpl">
    <runSequentially>true</runSequentially>
  </executionStrategy>
</matrix-project>
