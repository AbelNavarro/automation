<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description>This job submits packages from the &quot;staging&quot; subproject of an OBS project to the main project.&#xd;
Only packages that built successfully are submitted.</description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>project</name>
          <description>Name of the main project that should be updated with packages from its staging project.</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>subproject</name>
          <description>Name of the subproject that acts as staging project.</description>
          <defaultValue>None</defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <assignedNode>openstack-trackupstream</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers class="vector"/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>case $subproject in
  None) echo &quot;No valid &apos;subproject&apos; provided - defaults for safety reasons to &apos;None&apos;&quot;
        exit 1
  ;;
  &quot;-&quot;)  echo &quot;Subproject set to &apos;-&apos;: skip job, do not fail (eg. for Master project)&quot;
        exit 0
  ;;
esac

COS=$project
COSS=$COS:$subproject
export OBS_CHECKOUT=/home/jenkins/OBS_CHECKOUT/$COSS
OSC=&quot;osc -A https://api.opensuse.org&quot;
submitcmd=&quot;echo no submit for project=$project&quot;

case $project in
  Cloud:OpenStack:[EFGH]*)
    submitcmd=&quot;$OSC copypac -K -e&quot;
  ;;
  *) echo &quot;Please add support for the project: $project&quot;
     exit 1
esac

for COMPONENT in `$OSC ls $COSS 2&gt;/dev/null`
do
  cd $OBS_CHECKOUT || exit 1
  cd $COMPONENT || exit 1

  grep -q &quot;&lt;linkinfo&quot; .osc/_files || exit 2

  if $OSC rdiff $COS $COMPONENT $COSS | grep .  &amp;&amp;  $OSC api /build/$COSS/SLE_11_SP2/x86_64/$COMPONENT/_status | grep -q &apos;code=&quot;succeeded&quot;&apos;
  then
    $submitcmd $COSS $COMPONENT $COS
  fi
done</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers>
    <hudson.plugins.timestamper.TimestamperBuildWrapper plugin="timestamper@1.5.3"/>
    <org.jenkinsci.plugins.buildnamesetter.BuildNameSetter plugin="build-name-setter@1.3">
      <template>openstack-submit: ${ENV,var=&quot;project&quot;}:${ENV,var=&quot;subproject&quot;}</template>
    </org.jenkinsci.plugins.buildnamesetter.BuildNameSetter>
  </buildWrappers>
</project>